package org.no9.r2993;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.ServerSocket;
import java.net.Socket;

import android.app.Activity;
import android.content.Context;

public class SocketController implements Runnable{

	
	public static final String SERVERIP = "127.0.0.1";
	public static final int SERVERPORT = 4444;
	private final ISocketConnectionHandler mConnectionHandler;
	private final Context mApplicationContext;
	
	public SocketController(Activity parentActivity, ISocketConnectionHandler handler){
		mConnectionHandler = handler;
		mApplicationContext = parentActivity.getApplicationContext();
	}
	
	public void run() {
		 
        try {
        	
        	
            ServerSocket serverSocket = new ServerSocket(SERVERPORT);
            mConnectionHandler.onConnected();
        	
            while (true) {              

                Socket client = serverSocket.accept();
                try {



                     BufferedReader in = new BufferedReader(new InputStreamReader(client.getInputStream()));

                     String str = in.readLine();

                     System.out.println("S: Received: '" + str + "'");

                  

                } catch(Exception e) {

                       System.out.println("S: Error");

                       e.printStackTrace();

                  

                } finally {

                       client.close();

                       System.out.println("S: Done.");

                   }

            }      

        } catch (Exception e) {

            System.out.println("S: Error");

            e.printStackTrace();

        }

   }
}
