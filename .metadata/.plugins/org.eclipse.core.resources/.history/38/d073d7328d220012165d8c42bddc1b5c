package org.no9.r2993;

import android.os.Bundle;
import android.app.Activity;
import android.view.Menu;
import android.view.View;
import android.widget.Button; 
import android.widget.EditText;

public class RelayManager extends Activity {

	private static final int VID = 0x2341;
	private static final int PID_UNO = 0x0043;
	private static final int PID_MEGA = 0x0044;
	private static UsbController sUsbController;
	
    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_relay_manager);
        ((Button)findViewById(R.id.btnStart)).setOnClickListener(new View.OnClickListener() {
			@Override
			public void onClick(View v) {
				
				int PID = 0x0043;
				
				if(sUsbController == null)
					sUsbController = new UsbController(RelayManager.this, mConnectionHandler, VID, PID);
				else{
					sUsbController.stop();
					sUsbController = new UsbController(RelayManager.this, mConnectionHandler, VID, PID);
				}
			}
		});
    }

    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        getMenuInflater().inflate(R.menu.activity_relay_manager, menu);
        return true;
    }
    
    private final IUsbConnectionHandler mConnectionHandler = new IUsbConnectionHandler() {
		@Override
		public void onUsbStopped() {
			String msg = "Usb stopped!\n"; 
			EditText edt = (EditText)findViewById(R.id.editText1);
			edt.append(msg);
			L.e(msg);
		}
		
		@Override
		public void onErrorLooperRunningAlready() {
			String msg = "Looper already running!\n";
			EditText edt = (EditText)findViewById(R.id.editText1);
			edt.append(msg);
			L.e(msg);
			L.e("Looper already running!");
		}
		
		@Override
		public void onDeviceNotFound() {
			if(sUsbController != null){
				sUsbController.stop();
				sUsbController = null;
			}
		}
	};
    
}
